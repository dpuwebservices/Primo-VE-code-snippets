<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

<title>Primo VE Search Scope Form auto complete</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <link rel="stylesheet" href="css/styles.css?v=1.0">

</head>

<body>
  <script>
    


//PRIMO SEARCH BLOCK CONFIGURATION
//Primo searchPrimo() function
//Passes request to primo site
function searchPrimo() {
document.getElementById("primoQuery").value = "any,contains," + document.getElementById("primoQueryText").value.replace(/[,]/g, " ");
document.forms["searchForm"].submit();
}
//These are the search options matching what is on Primo
//Where title is the text to display in the option to the user
//Where tabID is the &tab variable in the Primo URL
//Where scopeID is the &search_scope variable in the Primo URL
var searchOptions = [
{
"title": "Everything",
"tabID": "Everything",
"scopeID": "MyInst_and_CI"
},
{
"title": "UAlbany Libraries",
"tabID": "LibraryCatalog",
"scopeID": "MyInstitution"
}, 
{
"title": "SUNY Libraries",
"tabID": "NEWSUNY",
"scopeID": "NewDiscoveryNetwork"
},
{
"title": "Course Reserves",
"tabID": "CourseReserves",
"scopeID": "CourseReserves"
}
];
document.addEventListener('DOMContentLoaded', function() {
var dropdown = document.getElementById('primoSearchFlags'); //gets the dropdown holder in the form
var autocomplete = document.getElementById('primoAutocomplete'); //gets the autocomplete div in the form
var autocompleteul = document.createElement('ul');
autocomplete.append(autocompleteul);
//create each dropdown element and autocomplete element
for (var i=0; i<searchOptions.length; i++) {
if(i==0) {
document.getElementById('dropdownTitle').innerHTML = searchOptions[i].title;
}
//dropdown element
var dropitem = document.createElement('a');
dropitem.classList.add('dropdown-item');
dropitem.setAttribute('tabID', searchOptions[i].tabID);
dropitem.setAttribute('id', searchOptions[i].tabID);
dropitem.setAttribute('scopeID', searchOptions[i].scopeID);
dropitem.innerHTML = searchOptions[i].title;
//append the drop element to DOM
dropdown.append(dropitem);
//set up a listener for on click to change the primo variables
dropitem.addEventListener("click", function(e) {
console.log(e);
var primotabval = document.getElementById('primoTabVal');
var primoscopeval = document.getElementById('primoScopeVal');
var dropdowntitle = document.getElementById('dropdownTitle');
//set the values for scope and tab
primotabval.value = e.target.attributes.tabID.nodeValue;
primoscopeval.value = e.target.attributes.scopeID.nodeValue;
dropdowntitle.innerHTML = e.target.innerHTML;
});
//autocomplete element
var autoitem = document.createElement('a');
autoitem.classList.add('autocomplete-result');
autoitem.setAttribute('id', searchOptions[i].tabID);
autoitem.setAttribute('tabID', searchOptions[i].tabID);
autoitem.setAttribute('scopeID', searchOptions[i].scopeID);
autoitem.innerHTML = "<span class='current-search-query'></span> in " + searchOptions[i].title +''; 
autocompleteul.append(autoitem);
document.getElementById('primoAutocomplete').style.display = 'none';
//listener for each autocomplete item
autoitem.addEventListener('click', function(e) {
console.log(e);
var primotabval = document.getElementById('primoTabVal');
var primoscopeval = document.getElementById('primoScopeVal');
//set the values for scope and tab
primotabval.value = e.target.attributes.tabID.nodeValue;
primoscopeval.value = e.target.attributes.scopeID.nodeValue;
//run the search since theyve clicked
searchPrimo();
})
};
//listener for text input change
document.getElementById('primoQueryText').addEventListener('input', validateAutocomplete);
//listener for when user stops focusing on input
document.getElementById('primoQueryText').addEventListener('focusout', function() {
setTimeout(validateAutocomplete, 2000);
});
//listener for when user focuses on input
document.getElementById('primoQueryText').addEventListener('focusin', validateAutocomplete);
function validateAutocomplete() {
var input = document.getElementById('primoQueryText');
var query = document.getElementById('primoQueryText').value;
if (input === document.activeElement && query.length > 1) {
//only show options if the input is focused and if there is 2 or more characters in query
console.log('greater than 2 and focused');
document.getElementById('primoAutocomplete').style.display = 'block';
var span = document.getElementsByClassName('current-search-query');
for (var x=0; x<span.length; x++) {
span[x].innerHTML = query;
}
} else {
//hide the div
document.getElementById('primoAutocomplete').style.display = 'none';
};
};
});


  </script>
  
  

<!-- Primo Search Form -->
<form id="simple" name="searchForm" method="get" target="_self" autocomplete="off" action="https://search.library.albany.edu/discovery/search" enctype="application/x-www-form-urlencoded; charset=utf-8" onsubmit="searchPrimo()">
   <!-- Customizable Parameters -->
   <input type="hidden" autocomplete="false">
   <input type="hidden" name="institution" value="suny-alb">
   <input type="hidden" name="vid" value="01SUNY_ALB:01SUNY_ALB">
   <input type="hidden" name="tab" value="Everything" id="primoTabVal"> <!-- This changes depending on dropdown -->
   <input type="hidden" name="search_scope" value="MyInst_and_CI" id="primoScopeVal"> <!-- This changes depending on dropdown -->
   <input type="hidden" name="mode" value="basic">
   <!-- Fixed parameters -->
   <input type="hidden" name="displayMode" value="full">
   <input type="hidden" name="bulkSize" value="10">
   <input type="hidden" name="highlight" value="true">
   <input type="hidden" name="dum" value="true">
   <input type="hidden" name="query" id="primoQuery">
   <input type="hidden" name="displayField" value="all">
   <!-- Enable this if "Expand My Results" is enabled by default in Views Wizard -->
   <input type="hidden" name="pcAvailabiltyMode" value="true">
   <div class="input-group">
      <input type="text" class="form-control" aria-label="Search Query" id="primoQueryText">
      <div class="input-group-append">
         <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="dropdownTitle">Everything</button>
         <div class="dropdown-menu" id="primoSearchFlags">
            <!-- Javascript takes care of search flags, see primoblock.js -->
         </div>
      </div>
   </div>
   <!-- Autocomplete placeholder -->
   <div class="primo-autocomplete" id="primoAutocomplete">
      <!-- Javascript takes care of adding autocomplete links as <a> tags  see primoblock.js -->
   </div>
   <!-- Search Button -->
   <input id="go" title="Search" onclick="searchPrimo()" type="button" value="Search" alt="Search" class="btn btn-primary">
</form>


</body>
</html>